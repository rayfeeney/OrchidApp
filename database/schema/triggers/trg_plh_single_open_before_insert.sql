CREATE DEFINER=`root`@`localhost` TRIGGER `trg_plh_single_open_before_insert` BEFORE INSERT ON `plantlocationhistory` FOR EACH ROW BEGIN\n    IF NEW.isActive = 1 AND NEW.endDateTime IS NULL THEN\n        IF EXISTS (\n            SELECT 1\n            FROM orchids.plantlocationhistory\n            WHERE plantId = NEW.plantId\n              AND isActive = 1\n              AND endDateTime IS NULL\n        ) THEN\n            SIGNAL SQLSTATE '45000'\n                SET MESSAGE_TEXT = 'Invariant violation: multiple open locations for plant';\n        END IF;\n    END


CREATE PROCEDURE `spAddGenus`(\n    IN  pGenusName           VARCHAR(100),\n    IN\tpGenusNotes\t\t\t TEXT,\n    OUT pGenusId             INT,\n    OUT pGenusOnlyTaxonId    INT\n)\nBEGIN\n    DECLARE vGenusName\tVARCHAR(100);\n    DECLARE vGenusNotes\tTEXT;\n    -- Single handler for all SQL exceptions\n    DECLARE EXIT HANDLER FOR SQLEXCEPTION\n    BEGIN\n        IF MYSQL_ERRNO = 1062 THEN\n            ROLLBACK;\n            SIGNAL SQLSTATE '45000'\n                SET MESSAGE_TEXT = 'Genus already exists';\n        ELSE\n            ROLLBACK;\n            RESIGNAL;\n        END IF;\n    END;\n\n    -- Defensive initialisation (after DECLAREs)\n    SET pGenusId = NULL;\n    SET pGenusOnlyTaxonId = NULL;\n\n    -- Normalise genus details\n    SET vGenusName\t= NULLIF(TRIM(pGenusName), '');\n    SET vGenusNotes\t= NULLIF(TRIM(pGenusNotes), '');\n\n    IF vGenusName IS NULL THEN\n        SIGNAL SQLSTATE '45000'\n            SET MESSAGE_TEXT = 'Genus name must be provided';\n    END IF;\n\n    START TRANSACTION;\n\n    -- Optional UX-friendly pre-check (still worth keeping)\n    IF EXISTS (\n        SELECT 1\n        FROM genus\n        WHERE genusName COLLATE utf8mb4_unicode_ci =\n              vGenusName COLLATE utf8mb4_unicode_ci\n    ) THEN\n        SIGNAL SQLSTATE '45000'\n            SET MESSAGE_TEXT = 'Genus already exists';\n    END IF;\n\n    INSERT INTO gen


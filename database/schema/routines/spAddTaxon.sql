CREATE PROCEDURE `spAddTaxon`(\n    IN  pGenusId      INT,\n    IN  pSpeciesName  VARCHAR(100),\n    IN  pHybridName   VARCHAR(150),\n    IN  pGrowthNotes  TEXT,\n    IN  pTaxonNotes   TEXT\n)\nBEGIN\n    DECLARE vGenusExists INT;\n    DECLARE vGenusIsActive INT;\n\n    DECLARE vSpeciesName VARCHAR(100);\n    DECLARE vHybridName  VARCHAR(150);\n\n    -- Normalise for validation\n    SET vSpeciesName = NULLIF(TRIM(pSpeciesName), '');\n    SET vHybridName  = NULLIF(TRIM(pHybridName), '');\n\n    -- Validate genus\n    SELECT COUNT(*), MAX(isActive)\n    INTO vGenusExists, vGenusIsActive\n    FROM genus\n    WHERE genusId = pGenusId;\n\n    IF vGenusExists = 0 THEN\n        SIGNAL SQLSTATE '45000'\n            SET MESSAGE_TEXT = 'Invalid genusId: genus does not exist';\n    END IF;\n\n    IF vGenusIsActive = 0 THEN\n        SIGNAL SQLSTATE '45000'\n            SET MESSAGE_TEXT = 'Cannot create species/hybrid for inactive genus';\n    END IF;\n\n    -- Enforce shape\n    IF vSpeciesName IS NULL AND vHybridName IS NULL THEN\n        SIGNAL SQLSTATE '45000'\n            SET MESSAGE_TEXT = 'Genus-only record creation is not allowed';\n    END IF;\n\n    IF vSpeciesName IS NOT NULL AND vHybridName IS NOT NULL THEN\n        SIGNAL SQLSTATE '45000'\n            SET MESSAGE_TEXT = 'Must be either species or hybrid, not both';\n    END IF;\n\n    -- Delegate ins


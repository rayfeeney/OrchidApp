@page "/Plants/Details/{plantId:int}"
@model OrchidApp.Web.Pages.Plants.DetailsModel

@{
    ViewData["Title"] = Model.PlantRequired.DisplayName;
}

<div class="row mb-3">

    <!-- Left column: title + details -->
    <div class="col-12 col-md-8">
        <h1>@Model.PlantRequired.DisplayName</h1>

        <dl class="row">
            <dt class="col-4 col-sm-3">Tag</dt>
            <dd class="col-8 col-sm-9">@Model.PlantRequired.PlantTag</dd>

            <dt class="col-4 col-sm-3">Location</dt>
            <dd class="col-8 col-sm-9">@Model.PlantRequired.LocationName</dd>
        </dl>
    </div>

    <!-- Right column: hero image -->
    @if (!string.IsNullOrWhiteSpace(Model.HeroImagePath))
    {
        <div class="col-12 col-md-4 mt-3 mt-md-0 text-md-end">
            <a asp-page="/Plants/Photos/Index"
               asp-route-plantId="@Model.PlantRequired.PlantId"
               class="d-block w-100">

                <img src="~/@Model.HeroImagePath"
                     class="img-fluid rounded shadow-sm w-100"
                     style="max-height:250px; object-fit:cover;" />
            </a>
        </div>
    }

</div>


<h2>History</h2>

    <div class="d-grid gap-2 d-sm-flex mb-3">
        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="Observation"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Add observation
        </a>

        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="LocationChange"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Move plant
        </a>

        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="Flowering"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Add flowering
        </a>

        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="Repotting"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Add repotting
        </a>
    </div>

@if (!Model.LifecycleEvents.Any())
{
    <p class="text-muted">No history recorded.</p>
}
else
{
    <table class="table table-sm">
        <thead>
            <tr>
                <th>Date</th>
                <th>Event</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var ev in Model.LifecycleEvents)
        {
            <tr>
                <td class="text-nowrap">
                    @ev.EventDateTime.ToString("dd/MM/yyyy")
                </td>
                <td>
                    <strong>@ev.EventType</strong><br />
                    @ev.EventSummary

                    @if (ev.EventType == "Observation" && ev.SourceTable == "plantevent")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Observation"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Observation"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                    @if (ev.EventType == "LocationChange" && ev.SourceTable == "plantlocationhistory")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="LocationChange"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="LocationChange"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                    @if (ev.EventType == "Flowering" && ev.SourceTable == "flowering")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Flowering"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Flowering"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                    @if (ev.EventType == "Repotting" && ev.SourceTable == "repotting")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Repotting"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Repotting"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                </td>
            </tr>
        }
        </tbody>
    </table>
}

<div class="mt-4">
    <a asp-page="/Plants/Index"
       class="btn btn-outline-secondary btn-lg w-100">
        ‚Üê Back to plants
    </a>
</div>
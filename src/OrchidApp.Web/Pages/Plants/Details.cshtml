@page "/Plants/Details/{plantId:int}"
@model OrchidApp.Web.Pages.Plants.DetailsModel

@{
    ViewData["Title"] = Model.PlantRequired.DisplayName;
}

<h1>@Model.PlantRequired.DisplayName</h1>

<dl class="row">
    <dt class="col-sm-3">Tag</dt>
    <dd class="col-sm-9">@Model.PlantRequired.PlantTag</dd>

    <dt class="col-sm-3">Location</dt>
    <dd class="col-sm-9">@Model.PlantRequired.LocationName</dd>
</dl>

<h2>History</h2>

    <div class="d-grid gap-2 d-sm-flex mb-3">
        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="Observation"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Add observation
        </a>

        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="LocationChange"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Move plant
        </a>

        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="Flowering"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Add flowering
        </a>

        <a asp-page="/Plants/Events/Add"
        asp-route-eventType="Repotting"
        asp-route-plantId="@Model.PlantRequired.PlantId"
        class="btn btn-sm btn-primary">
            Add repotting
        </a>
    </div>

@if (!Model.LifecycleEvents.Any())
{
    <p class="text-muted">No history recorded.</p>
}
else
{
    <table class="table table-sm">
        <thead>
            <tr>
                <th>Date</th>
                <th>Event</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var ev in Model.LifecycleEvents)
        {
            <tr>
                <td class="text-nowrap">
                    @ev.EventDateTime.ToString("yyyy-MM-dd")
                </td>
                <td>
                    <strong>@ev.EventType</strong><br />
                    @ev.EventSummary

                    @if (ev.EventType == "Observation" && ev.SourceTable == "plantevent")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Observation"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Observation"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                    @if (ev.EventType == "LocationChange" && ev.SourceTable == "plantlocationhistory")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="LocationChange"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="LocationChange"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                    @if (ev.EventType == "Flowering" && ev.SourceTable == "flowering")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Flowering"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Flowering"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                    @if (ev.EventType == "Repotting" && ev.SourceTable == "repotting")
                    {
                        <div class="d-flex gap-2 mt-2">
                            <a asp-page="/Plants/Events/Edit"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Repotting"
                            class="btn btn-sm btn-outline-secondary">
                                Edit
                            </a>

                            <a asp-page="/Plants/Events/Remove"
                            asp-route-plantId="@Model.PlantRequired.PlantId"
                            asp-route-sourceId="@ev.SourceId"
                            asp-route-eventType="Repotting"
                            class="btn btn-sm btn-outline-danger">
                                Remove
                            </a>
                        </div>
                    }

                </td>
            </tr>
        }
        </tbody>
    </table>
}

<div class="mt-4">
    <a asp-page="/Plants/Index"
        class="btn btn-outline-secondary btn-sm">
            ‚Üê Back to plants
    </a>
</div>
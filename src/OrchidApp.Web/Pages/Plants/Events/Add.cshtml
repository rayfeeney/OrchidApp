@page "/Plants/Events/Add/{plantId:int}/{eventType?}"
@model OrchidApp.Web.Pages.Plants.Events.AddModel

@{
    ViewData["Title"] = Model.EventType switch
    {
        "Observation" => "Add Observation",
        "LocationChange" => "Move Location",
        "Flowering" => "Add Flowering",
        "Repotting" => "Add Repotting",
        _ => "Add Event"
    };
}

<h1>@ViewData["Title"]</h1>

<div asp-validation-summary="ModelOnly"
     class="text-danger mb-3"></div>

@if (Model.PlantDisplayName != null)
{
    <p class="text-muted">
        for <strong>@Model.PlantDisplayName</strong>
        @if (!string.IsNullOrWhiteSpace(Model.PlantTag))
        {
            <span>(Tag: @Model.PlantTag)</span>
        }
    </p>
}

<form method="post">

    @* Observation *@
    @if (Model.EventType == "Observation")
    {
        <div class="mb-3">
            <label asp-for="EventDate" class="form-label">Observation date</label>
            <input asp-for="EventDate"
                   type="date"
                   class="form-control"
                   asp-format="{0:yyyy-MM-dd}" />
        </div>

        @* Future: Observation eventCode *@
        @*
        <div class="mb-3">
            <label asp-for="EventCode" class="form-label">Observation type</label>
            <select asp-for="EventCode" class="form-select">
                <option value="">-- select type --</option>
            </select>
        </div>
        *@

        <div class="mb-3">
            <label asp-for="EventDetails" class="form-label">Notes</label>
            <textarea asp-for="EventDetails"
                      class="form-control"
                      rows="4"
                      placeholder="e.g. Noticed new root growth, leaves firm and glossy">
            </textarea>
        </div>
    }

    @* LocationChange (stub for now) *@
    @if (Model.EventType == "LocationChange")
    {
        <div class="mb-3">
            <label asp-for="LocationId" class="form-label">Location</label>
            <select asp-for="LocationId" class="form-select">
                <option value="">-- select location --</option>
                @foreach (var loc in Model.Locations)
                {
                    <option value="@loc.LocationId">@loc.LocationName</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label asp-for="EventDate" class="form-label">Move date</label>
            <input asp-for="EventDate"
                type="date"
                class="form-control" />
        </div>

        //Not yet implemented: MoveReasonCode
        //<div class="mb-3">
        //  <label asp-for="MoveReasonCode" class="form-label">Reason</label>
        //  <input asp-for="MoveReasonCode" class="form-control" />
        //</div>

        <div class="mb-3">
            <label asp-for="EventDetails" class="form-label">Move reason</label>
            <textarea asp-for="EventDetails" class="form-control"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="PlantLocationNotes" class="form-label">Location notes</label>
            <textarea asp-for="PlantLocationNotes" class="form-control"></textarea>
        </div>
    }

    @* Flowering *@
    @if (Model.EventType == "Flowering")
    {
        <div class="mb-3">
            <label asp-for="StartDate" class="form-label">Start date</label>
            <input asp-for="StartDate"
                type="date"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="EndDate" class="form-label">End date (optional)</label>
            <input asp-for="EndDate"
                type="date"
                class="form-control" />
            <div class="form-text">
                Leave blank if currently flowering.
            </div>
        </div>

        <div class="mb-3">
            <label asp-for="SpikeCount" class="form-label">Spike count</label>
            <input asp-for="SpikeCount"
                type="number"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="FlowerCount" class="form-label">Flower count</label>
            <input asp-for="FlowerCount"
                type="number"
                class="form-control" />
        </div>

    <div class="mb-3">
        <label asp-for="EventDetails" class="form-label">Notes</label>
        <textarea asp-for="EventDetails"
                  class="form-control"
                  rows="4"></textarea>
    </div>

    }

    @* Repotting *@
    @if (Model.EventType == "Repotting")
    {
        <div class="mb-3">
            <label asp-for="EventDate" class="form-label">Repotting date</label>
            <input asp-for="EventDate"
                type="date"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="OldMediumNotes" class="form-label">Old medium notes</label>
            <textarea asp-for="OldMediumNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="NewMediumNotes" class="form-label">New medium notes</label>
            <textarea asp-for="NewMediumNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="PotSize" class="form-label">Pot size</label>
            <input asp-for="PotSize"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="RepotReasonNotes" class="form-label">Repotting reason</label>
            <textarea asp-for="RepotReasonNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="RepottingNotes" class="form-label">Additional notes</label>
            <textarea asp-for="RepottingNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>
    }

    <button type="submit" class="btn btn-primary">Save</button>

    <a asp-page="/Plants/Details"
       asp-route-plantId="@Model.PlantId"
       class="btn btn-secondary">
        Cancel
    </a>
</form>

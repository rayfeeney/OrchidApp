@page "/Plants/Events/Edit/{plantId:int}/{sourceId:int}"
@model OrchidApp.Web.Pages.Plants.Events.EditModel

@{
    ViewData["Title"] = Model.EventType switch
    {
        "Observation"   => "Edit Observation",
        "LocationChange"=> "Edit Location",
        "Flowering"     => "Edit Flowering",
        "Repotting"     => "Edit Repotting",
        _               => throw new InvalidOperationException("Unknown event type.")
    };
}

<h1>@ViewData["Title"]</h1>

<div asp-validation-summary="ModelOnly" 
     class="text-danger mb-3"></div>

@if (Model.PlantDisplayName != null)
{
    <p class="text-muted">
        for <strong>@Model.PlantDisplayName</strong>
        @if (!string.IsNullOrWhiteSpace(Model.PlantTag))
        {
            <span>(Tag: @Model.PlantTag)</span>
        }
    </p>
}

<form method="post">
    <input type="hidden" asp-for="EventType" />

    <div class="mb-3">
       <label asp-for="EventDate" class="form-label">
            @(Model.EventType switch
            {
                "Observation"    => "Noted on",
                "LocationChange" => "Moved on",
                "Repotting"      => "Repotted on",
                "Flowering"      => "Flowering started on",
                _                => "Date"
            })
        </label>

    @if (Model.EventType == "Observation")
    {
        <div class="mb-3">
            <label asp-for="EventDate" class="form-label">Observed on</label>
            <input asp-for="EventDate"
                type="date"
                class="form-control"
                asp-format="{0:yyyy-MM-dd}" />
        </div>

        @* Future: ObservationCode *@
        @*
        <div class="mb-3">
            <label asp-for="EventCode" class="form-label">Observation type</label>
            <select asp-for="EventCode" class="form-select"></select>
        </div>
        *@

        <div class="mb-3">
            <label asp-for="EventDetails" class="form-label">Notes</label>
            <textarea asp-for="EventDetails"
                    class="form-control"
                    rows="4"></textarea>
        </div>
    }

    @if (Model.EventType == "LocationChange")
    {
        <div class="mb-3">
            <label asp-for="EventDate" class="form-label">Moved on</label>
            <input asp-for="EventDate"
                type="datetime-local"
                class="form-control"
                asp-format="{0:yyyy-MM-ddTHH:mm}" />
        </div>

        @* Future: MoveReasonCode *@
        @*
        <div class="mb-3">
            <label asp-for="MoveReasonCode" class="form-label">Move reason</label>
            <select asp-for="MoveReasonCode" class="form-select"></select>
        </div>
        *@

        <div class="mb-3">
            <label asp-for="EventDetails" class="form-label">Move reason (notes)</label>
            <textarea asp-for="EventDetails"
                    class="form-control"
                    rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="PlantLocationNotes" class="form-label">Location notes</label>
            <textarea asp-for="PlantLocationNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>
    }

    @if (Model.EventType == "Flowering")
    {
        <div class="mb-3">
            <label asp-for="EventDate" class="form-label">Flowering started on</label>
            <input asp-for="EventDate"
                type="date"
                class="form-control"
                asp-format="{0:yyyy-MM-dd}" />
        </div>

        <div class="mb-3">
            <label asp-for="EndDate" class="form-label">Flowering ended on</label>
            <input asp-for="EndDate"
                type="date"
                class="form-control"
                asp-format="{0:yyyy-MM-dd}" />
        </div>

        <div class="mb-3">
            <label asp-for="SpikeCount" class="form-label">Spike count</label>
            <input asp-for="SpikeCount"
                type="number"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="FlowerCount" class="form-label">Flower count</label>
            <input asp-for="FlowerCount"
                type="number"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="EventDetails" class="form-label">Notes</label>
            <textarea asp-for="EventDetails"
                    class="form-control"
                    rows="3"></textarea>
        </div>
    }

    @* Repotting *@
    @if (Model.EventType == "Repotting")
    {
        <div class="mb-3">
            <label asp-for="EventDate" class="form-label">Repot date</label>
            <input asp-for="EventDate"
                type="date"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="OldMediumNotes" class="form-label">Old medium notes</label>
            <textarea asp-for="OldMediumNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="NewMediumNotes" class="form-label">New medium notes</label>
            <textarea asp-for="NewMediumNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="PotSize" class="form-label">Pot size</label>
            <input asp-for="PotSize"
                class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="RepotReasonNotes" class="form-label">Reason notes</label>
            <textarea asp-for="RepotReasonNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="RepottingNotes" class="form-label">Additional notes</label>
            <textarea asp-for="RepottingNotes"
                    class="form-control"
                    rows="3"></textarea>
        </div>
    }

    <button type="submit" class="btn btn-primary">Save changes</button>

    <a asp-page="/Plants/Details"
       asp-route-plantId="@Model.PlantId"
       class="btn btn-secondary">
        Cancel
    </a>
</form>
